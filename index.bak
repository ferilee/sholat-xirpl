<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Kehadiran Sholat - XI RPL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .stats-content { display: none; }
        .stats-content.active { display: block; }
        .chart-bar {
            transition: all 0.3s ease;
        }
        .chart-bar:hover {
            opacity: 0.8;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-emerald-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page active fade-in">
            <!-- Header -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">🕌 Dashboard Kehadiran Sholat</h1>
                <p class="text-gray-600 text-center mb-4">SMK Negeri Pasirian - Kelas XI RPL</p>
                
                <!-- Teacher Card -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 border border-green-200">
                    <div class="flex items-center justify-center">
                        <img src="https://live.staticflickr.com/65535/54509797172_fa540c8b67_b.jpg"
                              alt="Foto Guru"
                              class="w-16 h-16 rounded-full object-cover border-4 border-white shadow-lg mr-4"
                             onerror="this.src=''; this.alt='Avatar tidak dapat dimuat'; this.style.display='none';">
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-800">👨‍🏫 Guru Pengampu</h3>
                            <p class="text-green-600 font-medium">Feri Dwi Hermawan, S.Pd.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-xl transition-shadow cursor-pointer" onclick="showPage('attendancePage')">
                    <div class="text-4xl mb-4">📝</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Isi Kehadiran Sholat</h3>
                    <p class="text-gray-600">Input kehadiran sholat Dhuha dan Dhuhur</p>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-xl transition-shadow cursor-pointer" onclick="showPage('statisticsPage')">
                    <div class="text-4xl mb-4">📊</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Lihat Statistik</h3>
                    <p class="text-gray-600">Analisis data kehadiran sholat siswa</p>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">📋 Aktivitas Terbaru</h2>
                <div id="recentActivity" class="space-y-3">
                    <div class="flex items-center p-3 bg-green-50 rounded-lg">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                            <span class="text-green-600">🌅</span>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">Sholat Dhuha - 24 Siswa</p>
                            <p class="text-sm text-gray-600">Hari ini, 18 sholat, 4 berhalangan, 2 tidak sholat</p>
                        </div>
                    </div>
                    <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                            <span class="text-blue-600">📊</span>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">Statistik Mingguan</p>
                            <p class="text-sm text-gray-600">Tingkat kehadiran sholat meningkat 5% minggu ini</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attendance Form Page -->
        <div id="attendancePage" class="page">
            <!-- Header -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <button onclick="showPage('dashboardPage')" class="flex items-center text-green-600 hover:text-green-800 font-medium transition-colors">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Kembali ke Dashboard
                    </button>
                    <h1 class="text-2xl font-bold text-gray-800">📝 Form Kehadiran Sholat</h1>
                </div>
                
                <!-- Teacher Card -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 border border-green-200">
                    <div class="flex items-center justify-center">
                        <img src="https://live.staticflickr.com/65535/54509797172_fa540c8b67_b.jpg"
                              alt="Foto Guru"
                              class="w-16 h-16 rounded-full object-cover border-4 border-white shadow-lg mr-4"
                             onerror="this.src=''; this.alt='Avatar tidak dapat dimuat'; this.style.display='none';">
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-800">👨‍🏫 Guru Pengampu</h3>
                            <p class="text-green-600 font-medium">Feri Dwi Hermawan, S.Pd.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Prayer Selection and Date -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-lg font-semibold text-gray-700 mb-3">Pilih Sholat:</label>
                        <select id="prayerSelect" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors">
                            <option value="">-- Pilih Sholat --</option>
                            <option value="dhuha">🌅 Sholat Dhuha</option>
                            <option value="dhuhur">☀️ Sholat Dhuhur</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-lg font-semibold text-gray-700 mb-3">Tanggal:</label>
                        <input type="date" id="attendanceDate" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors">
                    </div>
                </div>
            </div>

            <!-- Student List -->
            <div id="studentList" class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Daftar Siswa XI RPL</h2>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="markAllStatus('sholat')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg transition-colors text-sm">
                            🕌 Semua Sholat
                        </button>
                        <button onclick="markAllStatus('berhalangan')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg transition-colors text-sm">
                            🚫 Semua Berhalangan
                        </button>
                        <button onclick="markAllStatus('tidak_sholat')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-colors text-sm">
                            ❌ Semua Tidak Sholat
                        </button>
                    </div>
                </div>
                
                <div id="studentsContainer" class="space-y-3">
                    <!-- Students will be loaded here -->
                </div>
                
                <!-- Summary -->
                <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-semibold text-gray-700 mb-2">Ringkasan Kehadiran Sholat:</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-center">
                        <div class="bg-green-100 p-3 rounded-lg">
                            <div class="text-xl font-bold text-green-600" id="sholatCount">0</div>
                            <div class="text-xs text-green-700">Sholat</div>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-lg">
                            <div class="text-xl font-bold text-yellow-600" id="berhalaganCount">0</div>
                            <div class="text-xs text-yellow-700">Berhalangan</div>
                        </div>
                        <div class="bg-red-100 p-3 rounded-lg">
                            <div class="text-xl font-bold text-red-600" id="tidakSholatCount">0</div>
                            <div class="text-xs text-red-700">Tidak Sholat</div>
                        </div>
                        <div class="bg-gray-100 p-3 rounded-lg">
                            <div class="text-xl font-bold text-gray-600" id="totalCount">0</div>
                            <div class="text-xs text-gray-700">Total</div>
                        </div>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <div class="mt-6 text-center">
                    <button onclick="validateAndSubmit()" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg text-lg font-semibold transition-colors shadow-lg">
                        💾 Simpan Kehadiran Sholat
                    </button>
                </div>
            </div>
            
            <!-- Success Message -->
            <div id="successMessage" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mt-6">
                <div class="flex items-center">
                    <span class="text-xl mr-2">✅</span>
                    <span>Data kehadiran sholat berhasil disimpan!</span>
                </div>
            </div>
            
            <!-- Error Message -->
            <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mt-6">
                <div class="flex items-start">
                    <span class="text-xl mr-2">❌</span>
                    <div>
                        <div class="font-semibold mb-2">Error:</div>
                        <div id="errorContent" class="text-sm"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Page -->
        <div id="statisticsPage" class="page">
            <!-- Header -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <button onclick="showPage('dashboardPage')" class="flex items-center text-green-600 hover:text-green-800 font-medium transition-colors">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Kembali ke Dashboard
                    </button>
                    <h1 class="text-2xl font-bold text-gray-800">📊 Statistik Kehadiran Sholat</h1>
                </div>
            </div>

            <!-- Statistics Dashboard -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">📊 Statistik Kehadiran Sholat</h2>
                    <button onclick="loadStatistics()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        🔄 Refresh Data
                    </button>
                </div>
                
                <!-- Loading Statistics -->
                <div id="statsLoading" class="hidden text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                    <p class="mt-2 text-gray-600">Memuat statistik...</p>
                </div>
                
                <!-- Statistics Tabs -->
                <div class="mb-6">
                    <div class="flex border-b border-gray-200">
                        <button onclick="showStatsTab('daily')" id="dailyTab" class="px-4 py-2 font-medium text-blue-600 border-b-2 border-blue-600">
                            📅 Harian
                        </button>
                        <button onclick="showStatsTab('weekly')" id="weeklyTab" class="px-4 py-2 font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent">
                            📊 Mingguan
                        </button>
                        <button onclick="showStatsTab('monthly')" id="monthlyTab" class="px-4 py-2 font-medium text-gray-500 hover:text-blue-600 border-b-2 border-transparent">
                            📈 Bulanan
                        </button>
                    </div>
                </div>
                
                <!-- Daily Statistics -->
                <div id="dailyStats" class="stats-content active">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Tanggal:</label>
                        <input type="date" id="dailyDatePicker" class="border border-gray-300 rounded-lg px-3 py-2" onchange="filterDailyStats()">
                    </div>
                    <div id="dailyStatsContent" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Daily stats will be loaded here -->
                    </div>
                </div>
                
                <!-- Weekly Statistics -->
                <div id="weeklyStats" class="stats-content">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Minggu:</label>
                        <input type="week" id="weeklyDatePicker" class="border border-gray-300 rounded-lg px-3 py-2" onchange="filterWeeklyStats()">
                    </div>
                    <div id="weeklyStatsContent" class="space-y-4">
                        <!-- Weekly stats will be loaded here -->
                    </div>
                </div>
                
                <!-- Monthly Statistics -->
                <div id="monthlyStats" class="stats-content">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Bulan:</label>
                        <input type="month" id="monthlyDatePicker" class="border border-gray-300 rounded-lg px-3 py-2" onchange="filterMonthlyStats()">
                    </div>
                    <div id="monthlyStatsContent" class="space-y-4">
                        <!-- Monthly stats will be loaded here -->
                    </div>
                </div>
                
                <!-- No Data Message -->
                <div id="noStatsData" class="hidden text-center py-8">
                    <div class="text-gray-400 text-6xl mb-4">📊</div>
                    <h3 class="text-lg font-medium text-gray-600 mb-2">Belum Ada Data Statistik</h3>
                    <p class="text-gray-500">Silakan simpan data kehadiran sholat terlebih dahulu</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <div class="text-center mb-4">
                <div class="text-4xl mb-2">⚠️</div>
                <h3 class="text-xl font-semibold text-gray-800">Konfirmasi Penyimpanan</h3>
            </div>
            <p class="text-gray-600 mb-6 text-center">
                Anda akan menyimpan data kehadiran sholat. Pastikan data sudah benar sebelum melanjutkan.
            </p>
            <div class="flex gap-3">
                <button onclick="hideConfirmationModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 rounded-lg transition-colors">
                    Batal
                </button>
                <button onclick="submitAttendance()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition-colors">
                    Ya, Simpan
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data and configuration
        let studentsData = [];
        let currentPrayer = '';
        let statisticsData = [];
        
        // Google Apps Script URL
        const webAppUrl = 'https://script.google.com/macros/s/AKfycbwQgGTKiZkxIVsC4QFiNbAGMJgFw5nYJCfXm2harBTRWy6YXHivvpX_ZXVi3Mf8SJZIQQ/exec';
        
        // Google Sheets CSV URL for statistics
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSk0ZnFPkHu2TpBkG90Kja6PkgrdJ9ndXMEsV4PpaBBNPMWY2pybk-NkhUKo1xMIakQGcO6xQAVsBNK/pub?gid=880745822&single=true&output=csv';
        
        // XI RPL Students Data
        const xiRplStudents = [
            'AULIA AZZARA NUR RAMDANI',
            'CHIKA AFINSA RAMADHANI',
            'RENO FIRMANSYAH',
            'RISQI ADITYA',
            'AUGUSTAV BRILLYAN SINDUARTHA',
            'PUTRA PUGUH PRADANA',
            'SALSAHIRA DUWI APRILIA',
            'WAHYU EKA ADI PRATAMA',
            'FIRDAUS ZIDDAN AZZAINURI',
            'MARVELINO ALFRADO',
            'MUHAMMAD EDI SANTOSO',
            'NABILA NUR AZIZAH',
            'ADINDA ANEZTYA ZAHRA',
            'FARHAN DHIYA\'UL HAQ',
            'RAFAEL ONIL MULYA PUTRA',
            'REYHAN ALIF RAMADHAN',
            'AYU DWI HANAFI',
            'BRIANDA WISNU YUSENA',
            'RAFI ARDIANSYAH EGI RAMADHAN',
            'VALENTINO AFASHA SALEH',
            'DINDA MAI SAFIRA',
            'MUHAMMAD HATTA PRIMA NURRAHMAN',
            'MUHAMMAD IRFAN KHOIRUL HIDAYAH',
            'NUR RAHMAD HIDAYAT'
        ];

        // Page Navigation Functions
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            document.getElementById(pageId).classList.add('fade-in');
            
            // Initialize page-specific content
            if (pageId === 'attendancePage') {
                initializeAttendancePage();
            } else if (pageId === 'statisticsPage') {
                initializeStatisticsPage();
            }
        }

        function initializeAttendancePage() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('attendanceDate').value = today;
            
            // Load students with default prayer
            if (!currentPrayer) {
                currentPrayer = 'dhuha';
                document.getElementById('prayerSelect').value = 'dhuha';
            }
            
            loadStudents();
            document.getElementById('studentList').classList.remove('hidden');
        }

        function initializeStatisticsPage() {
            // Set default date values
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dailyDatePicker').value = today;
            document.getElementById('weeklyDatePicker').value = getWeekString(new Date());
            document.getElementById('monthlyDatePicker').value = today.substring(0, 7);
            
            // Load statistics
            loadStatistics();
        }

        // Modal Functions
        function showConfirmationModal() {
            document.getElementById('confirmationModal').classList.remove('hidden');
        }

        function hideConfirmationModal() {
            document.getElementById('confirmationModal').classList.add('hidden');
        }

        // Validation function
        function validateAndSubmit() {
            const date = document.getElementById('attendanceDate').value;
            const prayer = document.getElementById('prayerSelect').value;
            
            if (!date || !prayer) {
                showError('Mohon lengkapi tanggal dan pilih jenis sholat!');
                return;
            }
            
            // Check if all students have status
            const hasEmptyStatus = studentsData.some(student => !student.status);
            if (hasEmptyStatus) {
                showError('Mohon pastikan semua siswa memiliki status kehadiran!');
                return;
            }
            
            // Show confirmation modal
            showConfirmationModal();
        }

        // Rest of your existing functions (loadStatistics, showStatsTab, etc.)
        // ... (all the existing functions from your original code)
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Show dashboard by default
            showPage('dashboardPage');
        });
    </script>

    <!-- Include all the existing JavaScript functions from your original code -->
    <script>
        // Copy all the existing JavaScript functions from your original code here
        // (loadStatistics, showStatsTab, filterDailyStats, etc.)
        // This would be too long to include in full, but you would copy all the existing functions
    </script>
</body>
</html>
